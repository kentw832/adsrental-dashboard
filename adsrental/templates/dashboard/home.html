{% extends 'base.html' %}

{% load bootstrap %}
{% load humanize %}
{% load helpers %}

{% block title %}Adsrental | Dashboard{% endblock %}

{% block content %}
<div class="">
    <div class="col-md-10">
        <h3>Filter presets</h3>
        <div class="btn-group" role="group" aria-label="Basic example">
            <a href="{% url 'dashboard' %}?lead_status=In-Progress&amp;preset=offline&amp;raspberry_pi_status=offline" type="button" class="btn {% if preset == 'offline' %}btn-primary{% else %} btn-default{% endif %}">
                In-Progress Offline
            </button>
            <a href="{% url 'dashboard' %}?lead_status=In-Progress&amp;preset=wrong_password&amp;wrong_password=yes" type="button" class="btn {% if preset == 'wrong_password' %}btn-primary{% else %} btn-default{% endif %}">
                In-Progress with Wrong Password
            </button>
            <a href="{% url 'dashboard' %}?lead_status=In-Progress&amp;preset=security_checkpoint&amp;security_checkpoint=yes" type="button" class="btn {% if preset == 'security_checkpoint' %}btn-primary{% else %} btn-default{% endif %}">
                In-Progress with Security checkpoint reported
            </a>
        </div>
        <h3>Results</h3>
        <table id="results" class="table table-striped" style="font-size: 60%;">
            <thead>
                <tr>
                    <th>#</th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' 'first_name' %}">Lead</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' 'raspberry_pi__rpid' %}">RPID</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' '-created' %}">Created</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' 'utm_source' %}">UTM</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' 'status' %}">Status</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' 'phone' %}">Phone</a></th>
                    <th>Address</th>
                    <th>Accounts</th>
                    <th>Online</th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' '-raspberry_pi__first_seen' %}">First Seen</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' '-raspberry_pi__last_seen' %}">Last Seen</a></th>
                    <th><a href="{% relative_url request.GET.urlencode 'order' '-qualified_date' %}">Qualified</a></th>
                    <th>Bundler Paid</th>
                    <th>Wrong Password</th>
                    <th>Security Checkpoint</th>
                    <th>Pi delivered</th>
                    <th>Sent</th>
                </tr>
            </thead>
            {% for entry in entries %}
                <tbody>
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{entry.first_name}} {{entry.last_name}}</td>
                        <td>{{ entry.raspberry_pi.rpid }}</td>
                        <td>{{ entry.created|date:'d M Y H:i' }}</td>
                        <td>{{ entry.utm_source }}</td>
                        <td>{{ entry.status }}</td>
                        <td>{{ entry.phone }}</td>
                        <td>
                            {{ entry.get_address }}
                            {% if entry.usps_tracking_code %}
                                <br />    
                                USPS: {{entry.usps_tracking_code}}
                            {% endif %}
                            {% if entry.is_order_on_hold %}
                                <a href="{% url 'dashboard_change_address' lead_id=entry.leadid %}">Fix</a>
                            {% endif %}
                        </td>
                        <td>
                            {% for lead_account in entry.lead_accounts.all %}
                                {{ lead_account }}
                                {% if lead_account.url %}
                                    (<a href="{{ lead_account.url }}">URL</a>) 
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td>
                            {% if entry.raspberry_pi.online %}
                                <span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>
                            {% else %}
                                <span class="glyphicon glyphicon-remove" style="color: red;"></span>
                            {% endif %}
                        </td>
                        <td title="{{ entry.raspberry_pi.get_first_seen }}">{{entry.raspberry_pi.get_first_seen|naturaltime|default:"Never"}}</td>
                        <td title="{{ entry.raspberry_pi.get_last_seen }}">{{entry.raspberry_pi.get_last_seen|naturaltime|default:"Never"}}</td>
                        <td title="{{ entry.get_qualified_date }}">{{entry.get_qualified_date|naturaltime|default:"Never"}}</td>
                        <td>
                            {% if entry.is_bundler_paid %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span>{% endif %}   
                        </td>
                        <td>
                            {% if entry.is_wrong_password %}
                                {% for lead_account in entry.lead_accounts.all %}
                                    {% if lead_account.is_wrong_password %}
                                        <span class="glyphicon glyphicon-ok" style="color: red;"></span>
                                        <a target="_blank" href="{% url 'dashboard_set_password' lead_account_id=lead_account.id %}">Fix</a>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <span class="glyphicon glyphicon-remove" style="color: lightgreen;"></span>
                            {% endif %}   
                        </td>
                        <td>
                            {% if entry.is_security_checkpoint_reported %}
                                <span class="glyphicon glyphicon-ok" style="color: red;"></span>
                            {% else %}
                                <span class="glyphicon glyphicon-remove" style="color: lightgreen;"></span>
                            {% endif %}   
                        </td>
                        <td>
                            {% if entry.pi_delivered %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span>{% endif %}           
                        </td>
                        <td>
                            {% if entry.ship_date %}
                                <span class="glyphicon glyphicon-ok" style="color: lightgreen;" title="{{entry.ship_date|default:"Never"}}"></span>
                            {% else %}
                                <span class="glyphicon glyphicon-remove" style="color: red;"</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            {% empty %}
                <tfoot>
                    <tr>
                        <th colspan="100">No entries found</th>
                    </tr>
                </tfoot>
            {% endfor %}
        </table>
        {% if entries.has_other_pages %}
          <ul class="pagination">
            {% if entries.has_previous %}
              <li><a href="{% relative_url request.GET.urlencode 'page' entries.previous_page_number %}">&laquo;</a></li>
            {% else %}
              <li class="disabled"><span>&laquo;</span></li>
            {% endif %}
            {% for i in entries.paginator.page_range %}
              {% if entries.number == i %}
                <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
              {% else %}
                <li><a href="{% relative_url request.GET.urlencode 'page' i %}">{{ i }}</a></li>
              {% endif %}
            {% endfor %}
            {% if entries.has_next %}
              <li><a href="{% relative_url request.GET.urlencode 'page' entries.next_page_number %}">&raquo;</a></li>
            {% else %}
              <li class="disabled"><span>&raquo;</span></li>
            {% endif %}
          </ul>
        {% endif %}
    </div>
    <div class="col-md-2">
        <form role="form" action="" method="GET" class="form-horizontal">
            {{ form|bootstrap }}
            <div class="form-group">
              <div class="col-sm-10 col-sm-offset-2">
                <button type="submit" class="btn btn-primary">Search</button>
              </div>
            </div>
        </form>
    </div>
        
{% endblock %}
